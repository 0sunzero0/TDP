<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <!-- bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">

    <!-- ajax -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>



    <script>
        $(document).ready(function () {
            list_til_board();
        });

        function list_til_board() {

            $.ajax({
                    type: "GET",
                    url: "/til/board",
                    data: {},
                    success: function (response) {
                        let all_til = response['all_til'];
                        for (let i = 0; i < all_til.length; i++) {
                            let title = all_til[i]['til_title'];
                            let user = all_til[i]['til_user'];
                            let day = all_til[i]['til_day'];
                            let temp_html = `<tr onClick="search('${title}')" style="cursor:pointer;">
                                                <th scope="row">${title}</th>
                                                <td>${user}</td>
                                                <td>${day}</td>
                                            </tr>`
                            $('#til-box').append(temp_html)
                        }
                    }
                }
            )
        }

        function search(title) {
            location.href = "http://localhost:5000/detail" + "?title=" + title;
        }


        function til_search() {
            $('#til-table > tbody:last').empty();
            let til_title = $('#search').val()

            $.ajax({
                type: "POST",
                url: '/til_board',
                data: {til_title: til_title},
                success: function (response) {
                    let find_til = response['til']
                    for (let i = 0; i < find_til.length; i++) {
                        let title = find_til[i]['til_title'];
                        let user = find_til[i]['til_user'];
                        let day = find_til[i]['til_day'];
                        let temp_html = `<tr>
                                                <th scope="row">${title}</th>
                                                <td >${user}</td>
                                                <td>${day}</td>

                                            </tr>`
                        $('#til-box').append(temp_html)
                    }
                }
            })
        }
        function goback(){
               window.history.back();
        }
    </script>

    <style>
        .wrap {
            margin: 50px auto;

        }

        .input-box {
            margin: 50px auto;
            width: 350px;
        }

        .navbar-brand {
            margin-left: 50px;
        }

        .nav-link {

            margin-left: 100px;
        }


    </style>
</head>


<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
        <a class="navbar-brand" href="/">TIL.D.P</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup"
                aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
            <div id="navbar-nav" class="navbar-nav">
                <a class="nav-link" href="./mytil_page">MyTIL</a>
                <a class="nav-link" href="https://github.com/">Github</a>
                <a class="nav-link" href="/">myPage</a>
                <a class="nav-link" href="/">logout</a>
                <a class="nav-link" onclick="goback()">Back</a>
            </div>
        </div>
    </div>
</nav>
<div class="container">
    <table class="table">
        <thead class="thead-light">
        <tr class="text-center">
            <th scope="col">TIL LIST</th>
        </tr>
        </thead>
    </table>
</div>

<div class="wrap">
    <div class="container">
        <table id="til-table" class="table">
            <thead>
            <tr>
                <th scope="col">제목</th>
                <th scope="col">작성자</th>
                <th scope="col">작성일</th>
            </tr>
            </thead>
            <tbody id="til-box">
            </tbody>
        </table>
        <a class="btn btn-primary" href="create_page" role="button">글쓰기</a>
        <div class="input-box">
            <div class="input-group mb-3">
                <div class="input-group-prepend">
                    <span class="input-group-text" id="basic-addon1">제목</span>
                </div>
                <input id="search" type="text" class="form-control" placeholder="검색어를 입력해주세요"
                       aria-label="Username">
                <button onclick="til_search()" type="button" id="btn-search" class="btn btn-primary">검색</button>
            </div>
        </div>
    </div>

</div>
</body>
</html>